<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>N-Back Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1c1c1e;
            --text-main: #ffffff;
            --text-muted: #8e8e93;
            --accent-color: #0a84ff;
            --success-color: #30d158;
            --error-color: #ff453a;
            --input-bg: #2c2c2e;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            /* overflow: hidden; –£–±–∏—Ä–∞–µ–º, —á—Ç–æ–±—ã –ø—Ä–∏ –º–∞–ª–µ–Ω—å–∫–æ–º —ç–∫—Ä–∞–Ω–µ –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—å */
        }

        body {
            font-family: 'Nunito', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: flex-start + margin: auto —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ª—É—á—à–µ –¥–µ—Ä–∂–∏—Ç –ø–æ–∑–∏—Ü–∏—é */
            justify-content: flex-start; 
            min-height: 100dvh; 
            box-sizing: border-box;
            /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ª–µ–∑–∞–Ω–∏—è –ø–æ–¥ —á–µ–ª–∫—É */
            padding: max(20px, env(safe-area-inset-top)) 20px 20px 20px;
        }

        .container {
            background: var(--card-bg);
            padding: 20px 20px; /* –ß—É—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
            border-radius: 24px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-sizing: border-box;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            flex-shrink: 0; 
            position: relative;
            /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –¶–µ–Ω—Ç—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ margin auto */
            margin: auto;
        }

        h1 { margin: 0 0 10px 0; color: var(--accent-color); font-size: 2rem; font-weight: 800; }
        .hidden { display: none !important; }
        
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .setup-group { display: flex; justify-content: space-between; margin-bottom: 20px; margin-top: 20px; }
        .input-group { display: flex; flex-direction: column; align-items: center; width: 45%; }
        label { font-size: 0.95rem; color: var(--text-muted); margin-bottom: 8px; font-weight: 700; }
        
        input[type="number"] {
            background: var(--input-bg); border: none; color: white;
            padding: 14px; border-radius: 16px; font-size: 1.4rem;
            width: 100%; text-align: center; box-sizing: border-box;
            font-family: 'Nunito', sans-serif; font-weight: 700;
        }

        button.main-btn {
            background-color: var(--accent-color); color: white; font-weight: 800;
            border: none; padding: 18px; font-size: 1.2rem; border-radius: 18px;
            width: 100%; cursor: pointer; margin-top: 10px;
        }
        button.main-btn:active { opacity: 0.7; transform: scale(0.98); }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            color: var(--text-muted); font-size: 1rem; margin-bottom: 15px;
            border-bottom: 2px solid #2c2c2e; padding-bottom: 10px; font-weight: 700;
        }

        .control-btn {
            background: rgba(255,255,255,0.1);
            border: none; color: var(--text-muted);
            width: 40px; height: 40px; border-radius: 50%;
            font-size: 1.1rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Nunito', sans-serif;
        }
        .control-btn:active { background: rgba(255,255,255,0.2); color: white; }

        #word-card {
            background: #252525;
            border-radius: 20px;
            padding: 20px 10px; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ –ø–∞–¥–¥–∏–Ω–≥ */
            margin-bottom: 20px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #word-display {
            font-size: 2.6rem; font-weight: 800; color: #fff;
            text-transform: uppercase; margin: 0;
            word-break: break-word; hyphens: auto;
        }

        /* –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ */
        #input-area { width: 100%; animation: slideUp 0.3s ease-out; }
        
        #game-form { width: 100%; display: flex; flex-direction: column; gap: 15px; }

        #native-input {
            width: 100%; padding: 16px; 
            /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –®—Ä–∏—Ñ—Ç –±–æ–ª—å—à–µ */
            font-size: 1.6rem; 
            background-color: var(--input-bg);
            border: 3px solid #3a3a3c;
            border-radius: 18px;
            color: white; text-align: center;
            box-sizing: border-box; outline: none;
            -webkit-appearance: none; 
            font-family: 'Nunito', sans-serif; font-weight: 800; /* –ñ–∏—Ä–Ω–µ–µ */
        }

        #native-input:focus { border-color: var(--accent-color); background-color: #303033; }
        #native-input::placeholder { color: #555; font-size: 1.1rem; font-weight: 600; }

        .input-error { border-color: var(--error-color) !important; background-color: rgba(255, 69, 58, 0.1) !important; animation: shake 0.4s; }
        .input-success { border-color: var(--success-color) !important; background-color: rgba(48, 209, 88, 0.1) !important; }

        #attempts-bar { 
            margin-bottom: 5px; font-size: 1.6rem; letter-spacing: 5px; height: 35px; 
            opacity: 0.9; 
        }
        
        #feedback-msg {
            height: 20px; font-size: 1rem; margin-top: 5px; font-weight: 700;
        }

        #pause-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            border-radius: 24px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 10;
            backdrop-filter: blur(5px);
        }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div id="setup-screen" class="container">
        <h1>N-Back</h1>
        <div style="text-align: left; background: #252525; padding: 20px; border-radius: 18px; font-size: 1rem; line-height: 1.5; color: #ccc;">
            <strong>–ü—Ä–∞–≤–∏–ª–∞:</strong><br>
            1. –ó–∞–ø–æ–º–∏–Ω–∞–π—Ç–µ —Å–ª–æ–≤–∞.<br>
            2. –í–≤–æ–¥–∏—Ç–µ —Å–ª–æ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ <strong>N —à–∞–≥–æ–≤ –Ω–∞–∑–∞–¥</strong>.<br>
            <br>
            <em style="color:#777">–ë–∞–∑–∞: 1000 —Å–ª–æ–≤.</em>
        </div>

        <div class="setup-group">
            <div class="input-group">
                <label>–£—Ä–æ–≤–µ–Ω—å N</label>
                <input type="number" id="n-level" value="2" min="1" max="10">
            </div>
            <div class="input-group">
                <label>–í—Å–µ–≥–æ —Å–ª–æ–≤</label>
                <input type="number" id="round-count" value="25" min="10" max="200">
            </div>
        </div>
        
        <button class="main-btn" onclick="startGame()">–ù–ê–ß–ê–¢–¨</button>
    </div>

    <div id="game-screen" class="container hidden">
        
        <div class="top-bar">
            <button class="control-btn" onclick="stopGame()">‚úï</button>
            <div style="display:flex; gap:15px; align-items:center;">
                <span>–£—Ä–æ–≤–µ–Ω—å <span style="color:var(--accent-color)" id="display-n">2</span></span>
                <span id="progress">0/0</span>
            </div>
            <button class="control-btn" onclick="togglePause()">II</button>
        </div>

        <div id="pause-overlay" class="hidden">
            <h2 style="color:white; margin-bottom:30px; font-size: 2rem;">–ü–ê–£–ó–ê</h2>
            <button class="main-btn" style="width: 70%;" onclick="togglePause()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
            <button class="main-btn" style="width: 70%; background:#333; margin-top:15px;" onclick="stopGame()">–í –ú–ï–ù–Æ</button>
        </div>

        <div id="word-card">
            <div id="word-display">...</div>
        </div>

        <div id="input-area" class="hidden">
            <div id="attempts-bar">üñ§ üñ§ üñ§</div>
            <form id="game-form" autocomplete="off" onsubmit="handleFormSubmit(event)">
                <input type="text" id="native-input" 
                       placeholder="–°–ª–æ–≤–æ N –Ω–∞–∑–∞–¥?" 
                       autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                       enterkeyhint="done">
            </form>
            <div id="feedback-msg"></div>
        </div>
        
        <div id="wait-msg" style="color: #777; font-size: 1.1rem; margin-top: 30px; font-weight: 600;" class="hidden">
            –ó–∞–ø–æ–º–∏–Ω–∞–µ–º...
        </div>
    </div>

    <div id="result-screen" class="container hidden">
        <h1 style="color: var(--success-color)">–ì–æ—Ç–æ–≤–æ!</h1>
        <div style="background: #252525; padding: 25px; border-radius: 20px; margin: 25px 0;">
            <p style="margin: 8px 0; color:#aaa; font-size: 1.2rem;">–£—Ä–æ–≤–µ–Ω—å: <b style="color:white" id="res-level"></b></p>
            <p style="margin: 8px 0; color:#aaa; font-size: 1.2rem;">–ü—Ä–æ–π–¥–µ–Ω–æ —Å–ª–æ–≤: <b style="color:white" id="final-score"></b></p>
        </div>
        <button class="main-btn" onclick="showSetup()">–ú–ï–ù–Æ</button>
    </div>

    <script>
        const rawVocabulary = `
–≥–æ–¥ —á–µ–ª–æ–≤–µ–∫ –≤—Ä–µ–º—è –¥–µ–ª–æ –∂–∏–∑–Ω—å –¥–µ–Ω—å —Ä—É–∫–∞ —Ä–∞–∑ —Ä–∞–±–æ—Ç–∞ —Å–ª–æ–≤–æ –º–µ—Å—Ç–æ –ª–∏—Ü–æ –¥—Ä—É–≥ –≥–ª–∞–∑ –≤–æ–ø—Ä–æ—Å –¥–æ–º —Å—Ç–æ—Ä–æ–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ –º–∏—Ä —Å–ª—É—á–∞–π –≥–æ–ª–æ–≤–∞ —Ä–µ–±–µ–Ω–æ–∫ —Å–∏–ª–∞ –∫–æ–Ω–µ—Ü –≤–∏–¥ —Å–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç—å –≥–æ—Ä–æ–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∂–µ–Ω—â–∏–Ω–∞ –¥–µ–Ω—å–≥–∏ –∑–µ–º–ª—è –º–∞—à–∏–Ω–∞ –≤–æ–¥–∞ –æ—Ç–µ—Ü –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∞–≤–æ –Ω–æ–≥–∞ —Ä–µ—à–µ–Ω–∏–µ –¥–≤–µ—Ä—å –æ–±—Ä–∞–∑ –∏—Å—Ç–æ—Ä–∏—è –≤–ª–∞—Å—Ç—å –∑–∞–∫–æ–Ω –≤–æ–π–Ω–∞ –±–æ–≥ –≥–æ–ª–æ—Å —Ç—ã—Å—è—á–∞ –∫–Ω–∏–≥–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–æ—á—å —Å—Ç–æ–ª –∏–º—è –æ–±–ª–∞—Å—Ç—å —Å—Ç–∞—Ç—å—è —á–∏—Å–ª–æ –∫–æ–º–ø–∞–Ω–∏—è –Ω–∞—Ä–æ–¥ –∂–µ–Ω–∞ –≥—Ä—É–ø–ø–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ—Ü–µ—Å—Å —É—Å–ª–æ–≤–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–æ —Å–≤–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ —Å–æ–ª–Ω—Ü–µ –ª—é–±–æ–≤—å —Å–ª—É—Ö –ø—Ä–æ–µ–∫—Ç —á–∞—Å –ø–æ—Ä—è–¥–æ–∫ –ø—É—Ç—å –¥—É—à–∞ –ø–æ–º–æ—â—å —Ä—ã–Ω–æ–∫ –æ—á–µ—Ä–µ–¥—å –ø–∏—Å—å–º–æ –∞—Ä–º–∏—è –≤–µ–∫ —Ö–æ–¥ —è–∑—ã–∫ —Ä—è–¥ –¥–≤–∏–∂–µ–Ω–∏–µ –æ–≥–æ–Ω—å –¥–∏—Ä–µ–∫—Ç–æ—Ä —Å—Ç–µ–Ω–∞ –≤—Å—Ç—Ä–µ—á–∞ —Ü–µ–ª—å —à–∫–æ–ª–∞ –ø–ª–∞–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–æ–∑–¥—É—Ö –∏–Ω—Ç–µ—Ä–µ—Å —Å–º–µ—Ä—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–¥–∞—á–∞ –æ–ø—ã—Ç —Ç–µ–ª–æ –∏–≥—Ä–∞ –ª–µ—Å –¥–≤–æ—Ä –æ–∫–Ω–æ —Ü–µ–Ω—Ç—Ä —Å–µ–º—å—è –ø–ª–µ—á–æ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç –≤—Ä–∞—á –Ω–æ–º–µ—Ä —Å—É–¥ —É–≥–æ–ª —É—á–∏—Ç–µ–ª—å —Ä–∞–π–æ–Ω –Ω–µ–±–æ —Å–æ–≤–µ—Ç –∑–æ–ª–æ—Ç–æ –º—É–∑—ã–∫–∞ –ø–∞–º—è—Ç—å –≥—Ä–∞–Ω–∏—Ü–∞ –∑–Ω–∞–∫ —Ñ–æ—Ä–º–∞ —Å–æ–±–∞–∫–∞ –∫–∞–º–µ–Ω—å –±–æ–ª—å —Å—ã–Ω –º—ã—Å–ª—å —Å–ø–æ—Ä—Ç –≥–µ—Ä–æ–π –¥–µ—Ä–µ–≤–æ –∑–¥–∞–Ω–∏–µ —Å–≤—è–∑—å –ø–æ—ç—Ç —Å–Ω–µ–≥ —Å–æ–Ω —ç–ª–µ–º–µ–Ω—Ç —É—Ö–æ –≤–µ—Ä–∞ –æ—Å—Ç—Ä–æ–≤ –±–∞–Ω–∫ —Ä–∞—Å—Ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª –≤–æ–ª—è —Å–∞–¥ –∫—É—Ä—Å —Ä–µ–∫–∞ –º—É–∂–∏–∫ —Ä–æ—Ç –∫—Ä–∞–π –º–æ—Å—Ç –ª–∏—Å—Ç —á–µ—Å—Ç—å –∞–≤—Ç–æ—Ä –≤–µ—á–µ—Ä —Ü–≤–µ—Ç –ø–æ–ª–∫ —Ä–∞–¥–æ—Å—Ç—å –ø—Ç–∏—Ü–∞ –∫—Ä—É–≥ —Ç—Ä—É–ø —Å–º—ã—Å–ª –º–∞—Å–ª–æ –¥–æ–∂–¥—å —ç–∫—Ä–∞–Ω —Å–ª–µ–∑–∞ –∑–≤–µ—Ä—å –∫–æ–Ω–∫—É—Ä—Å —Ç–∞–Ω–µ—Ü –Ω–æ—Å –∫–æ—Ä–µ–Ω—å –ø–µ—Å–Ω—è –∫–ª–∞—Å—Å –∑–∞–≤–æ–¥ —É–¥–∞—Ä –ª–∏–¥–µ—Ä —ç—Ç–∞–ø –±—Ä–∞—Ç —Å—Ç—É–ª —à—Ç–∞–± –∑–≤—É–∫ –¥–µ–¥ –º–µ—Ç—Ä –ø–µ—Å–æ–∫ —Å—Ç–∏—Ö —Ö–ª–µ–± —Ñ–∏–ª—å–º —Ä—É–±–ª—å —à–∞–Ω—Å —Ç–∏–ø —Å–º–µ—Ö –º–æ—Ä–µ –∑–æ–Ω–∞ —Ç–æ–≤–∞—Ä –∫—É—Å–æ–∫ —Å–ª—É–∂–±–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä –≤–æ–∑—Ä–∞—Å—Ç —Ä—ã–±–∞ —Ä–æ—Å—Ç —Å—Ü–µ–Ω–∞ –∫—Ä—ã—à–∞ –ø–æ–∏—Å–∫ –¥–æ–ª–≥ –≤–æ–∂–¥—å –º–æ–∑–≥ –∏—Ç–æ–≥ –ø–∏–≤–æ —á–∞–π –≥—É–±–∞ –¥—è–¥—è —á–µ—Ä—Ç –∫–æ–Ω—å —à–µ—è —Ç–∞–Ω–∫ –∫–∞–¥—Ä —Å–ª–æ–π —Å–ø–æ—Ä –≤–∫—É—Å —Å–ª–µ–¥ —Ç–æ–ª–ø–∞ –≤—Ö–æ–¥ —Ä–∏—Å–∫ —É–∫–∞–∑ –∑–∏–º–∞ –º–æ–¥–∞ —à—É–º –ª–µ—Ç–æ –ø–æ—Å—Ç —Å–±–æ—Ä –∫—É—Å—Ç –æ–±–µ–¥ –≤—Ä–µ–¥ —à–∞—Ä—Ñ –ø–∞—É–∫ —Å–ª–æ–Ω —Ü–∏—Ä–∫ –±–∞–∫ –±–æ–∫—Å –≤–∏–Ω—Ç –≥—Ä–∏–± –∑–æ–Ω—Ç –∫–ª–æ–ø –∫–ª–µ–π –ª–∏—Ñ—Ç –ø—É–ª—è —Ç–æ—Ä—Ç —Ñ–ª–∞–≥ —Ü–µ–ø—å —à–∏–Ω–∞ —é–±–∫–∞ —è—â–∏–∫ –≥—Ä–æ–º —Ö–æ–ª–º —Ç–∏–≥—Ä –≤–æ–ª–∫ –±–∞—Ä—Å —Ä—ã—Å—å –∫—Ä–∞–± –æ–º–∞—Ä —Å–∫–∞—Ç –∫–∏—Ç –º–æ—Ä–∂ –ø–æ–Ω–∏ –æ–≤—Ü–∞ –∫–æ–∑–∞ –ª–æ—Å—å –µ–Ω–æ—Ç –∫—Ä–æ—Ç –º—ã—à—å —Å–æ–≤–∞ –≥—É—Å—å —É—Ç–∫–∞ –∞–∏—Å—Ç –≥—Ä–∞—á —Å—Ç—Ä–∏–∂ —É–¥–∞–≤ –æ—Å–∞ –º—É—Ö–∞ –±–ª–æ—Ö–∞ –∫–ª–µ—â –º–æ–ª—å —Ä–∞–∫ —â—É–∫–∞ –∫–∞—Ä–ø —Å–æ–º –ª–∏–Ω—å –∞–≥–∞—Ç –∞–ª–º–∞–∑ –±–æ–ª—Ç –≥–∏–ø—Å –¥–µ—Ä–Ω –∂–µ—Å—Ç—å –∏–≥–ª–∞ –∫–æ–≤—à –ª–æ–º –º–∞—è–∫ –Ω–æ–∂ –ø–ª—É–≥ —Ä—É–ª—å —Å–µ—Ç—å —Ç—Ä–æ—Å —É–∑–µ–ª —à–∏–ø —â–∏—Ç —è–∫–æ—Ä—å –∞–∑–æ—Ç –±—Ä–æ–º –≤–æ—Å–∫ –≥–∞–∑ –≥–µ–ª—å –¥—ã–º –π–æ–¥ –ª–∞–∫ –º–µ–ª –ø–∞—Ä –ø—É—Ö —Å–∞–∂–∞ —Å–æ–ª—å —Ç–æ—Ä—Ñ —É—Ä–∞–Ω —Ö—Ä–æ–º —Ü–∏–Ω–∫ —à–ª–∞–∫ –±–æ—Ä –≤—è–∑ –¥—É–± –∏–≤–∞ –∫–µ–¥—Ä –∫–ª–µ–Ω –ª–∏–ø–∞ –ø–∞–ª—å–º–∞ —Ä–æ–∑–∞ –∞–ª–æ—ç –º–∞–∫ –ø–∏–æ–Ω –∏—Ä–∏—Å –∞–Ω–∏—Å –±–æ–± –ª—É–∫ —Ä–∞–ø—Å —Ä–∏—Å —Å–æ—è —Ç—ã–∫–≤–∞ —É–∫—Ä–æ–ø —Ö–≤–æ—â —à–ø–∏–Ω–∞—Ç –≤–µ–Ω–∞ –≤–µ–∫–æ –¥–µ—Å–Ω–∞ –∂–∏–ª–∞ –∑—É–± –∫–æ–∂–∞ –∫–æ—Å—Ç—å –Ω–µ—Ä–≤ –Ω–æ–≥–æ—Ç—å –ø—É–ø —Ä–µ–±—Ä–æ —Ç–∞–∑ —á–µ—Ä–µ–ø –±–∏–Ω—Ç –≤–∞—Ç–∞ –∂–≥—É—Ç –º–∞–∑—å –∑–æ–Ω–¥ –∫–ª–∏–∑–º–∞ –æ—á–∫–∏ —à–ø—Ä–∏—Ü –≥–∏–º–Ω –¥–∂–∞–∑ –º–∞—Ä—à –Ω–æ—Ç–∞ –æ–ø–µ—Ä–∞ –æ–ø—É—Å —Ä–∏—Ç–º —Å–æ–ª–æ —Ç—É—à —Ö–æ—Ä –±–∞–ª–ª –≥–µ–π–º –≥–æ–ª –ø–∞—Å —Å–µ—Ç —Ñ–∏–Ω—Ç —à–∞—Ö –º–∞—Ç –∫—Ä–æ—Å—Å —Å—Ç–∞—Ä—Ç —Ç—Ä–µ–∫ —è–º–± —Ö–æ—Ä–µ–π —Å—Ç–æ–ø–∞ —Å–ª–æ–≥ —ç–ø–æ—Å –º–∏—Ñ –æ–¥–∞ —Å–∫–∞–∑ –∂–∞–Ω—Ä —Å—Ç–∏–ª—å —Ç–µ–º–∞ —Ç–æ–º –±–æ—Ç –±—Ä–∏–≥ –ø–ª–æ—Ç –ø–æ—Ä—Ç —Ç—Ä–∞–ø —Ç—Ä—é–º —à–ª—é–∑ —è–ª–∏–∫ –∫—Ä–∞—Ö –∫—Ä–∏–∑–∏—Å –Ω–∞–ª–æ–≥ —Å–±—ã—Ç —Ç–æ—Ä–≥ —Ü–µ–Ω–∞ —á–µ–∫ —à—Ç—Ä–∞—Ñ –≤–∏–∑–∞ –∏—Å–∫ –∫–æ–¥–µ–∫—Å —É—Å—Ç–∞–≤ —Ü–µ–Ω–∑ —à—Ç–∞—Ç –±—Ä–∞–∫ –≤–Ω—É–∫ –≤–¥–æ–≤–∞ –∑—è—Ç—å –∫—É–º —Å–≤–∞—Ç —Ç–µ—Å—Ç—å —Ç–µ—Ç—è –∞—Ç–æ–º –≤–∞—Ç—Ç –≤–æ–ª—å—Ç –¥–∂–æ—É–ª—å –∏–æ–Ω –∫–∞—Ç–æ–¥ –∫–≤–∞–Ω—Ç –æ–º —Ñ–∞–∑–∞ —Ñ–æ–Ω —ç—Ö–æ –∞–Ω–æ–¥ –¥–∏–æ–¥ –ª–∞–º–ø–∞ –ª—É—á —Ä–µ–ª–µ —Ç–æ–∫ —â—É–ø
–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç —Å–∏—Ç—É–∞—Ü–∏—è –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω –≤–Ω–∏–º–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —ç–∫–æ–Ω–æ–º–∏–∫–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—â–µ—Å—Ç–≤–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä—ã–Ω–æ–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä –∫—É–ª—å—Ç—É—Ä–∞ –Ω–∞—Å–µ–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–µ–Ω—å —á–ª–µ–Ω –º–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∞ –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –∫–æ–ª–ª–µ–∫—Ç–∏–≤ –¥–æ–ª–∂–Ω–æ—Å—Ç—å –º–µ—Å—è—Ü –ø–æ–ª–∏—Ç–∏–∫–∞ —Ñ–µ–¥–µ—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª—å –ø–æ–∑–∏—Ü–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å–æ—Å—Ç–∞–≤ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è –æ–±—ä–µ–∫—Ç –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Å—Ñ–µ—Ä–∞ –∑–∞–ª –¥–æ–∫—É–º–µ–Ω—Ç —Å–µ–∫—Ç–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å–µ–∫—É–Ω–¥–∞ —è–∑—ã–∫ —Ö–æ–∑—è–π—Å—Ç–≤–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–∏–ª–∏—Ü–∏—è –≤–æ—Å—Ç–æ–∫ –ø–∏—Å–∞—Ç–µ–ª—å —Å–≤–æ–±–æ–¥–∞ —É—Ö–æ–¥ –∫–∞–º–µ–Ω—å —Ç–µ—Ö–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç —Ä–∞—Å—Å–∫–∞–∑ –ø–∞—Ä–µ–Ω—å –æ–±–æ—Ä–æ–Ω–∞ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç–∞ –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—á–∏–π —Å–æ–∑–Ω–∞–Ω–∏–µ –∫–∞—Ä—Ç–∞ –≥–∞–∑–µ—Ç–∞ –æ—Å–Ω–æ–≤–∞ –∫–æ–º–∞–Ω–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å—Ä–µ–¥–∞ —Ä—É–±–ª—å —Ü–µ—Ä–∫–æ–≤—å –æ—Ö—Ä–∞–Ω–∞ –Ω–∞–¥–µ–∂–¥–∞ –ø—Ä–∏—Ä–æ–¥–∞ –ª–µ–π—Ç–µ–Ω–∞–Ω—Ç –ø—Ä–µ–¥–º–µ—Ç —Ç–µ—Ä–º–∏–Ω —Å–µ—Ä–∏—è –ø–æ–Ω—è—Ç–∏–µ –∫–∞–¥—Ä –∏—Å–∫—É—Å—Å—Ç–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–≤—É—à–∫–∞ –æ—á–µ—Ä–µ–¥—å –±–µ—Å–µ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–∏–∫–∞–∑ –∫–æ–ª—å—Ü–æ –≤–∑–≥–ª—è–¥ –∂–µ–ª–∞–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∞ –∑–µ—Ä–∫–∞–ª–æ –∑–≤–µ—Ä—å –æ—á–µ—Ä–µ–¥—å –º–µ—Ç–æ–¥ —Ö–æ–∑—è–π–∫–∞ —á—É–≤—Å—Ç–≤–æ —Å—Ç–∞–Ω—Ü–∏—è –ø—Ä–∞–∑–¥–Ω–∏–∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä —Ç–µ–æ—Ä–∏—è –ø–æ–¥–ø–∏—Å—å —Ñ–∏–ª—å–º –º–∞–≥–∞–∑–∏–Ω –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Å–ø–æ–¥–∏–Ω –ø—Ä–∏–Ω—Ü–∏–ø —Å—É—â–µ—Å—Ç–≤–æ –º–∞–π–æ—Ä —Å–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞–ª –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã–µ –ª–∏—á–Ω–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏—è —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É—Å–ø–µ—Ö –≤–æ–ª—è —Ä–µ–∂–∏–º –≤—ã–±–æ—Ä—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–∞–¥–∏—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —à—Ç–∞–± —Ä–µ–¥–∞–∫—Ü–∏—è –∑–∞–≤–æ–¥ —Ñ–∞–∫—Ç–æ—Ä –æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–∞–π–æ–Ω –ø–æ—Ç–µ—Ä—è –≤–æ–¥–∏—Ç–µ–ª—å —Ä–µ–∫–ª–∞–º–∞ –ø—É–±–ª–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ —Ç–µ–ª–µ—Ñ–æ–Ω —Å—Ç–∞–∫–∞–Ω —Å—É–¥—å–±–∞ —á–∏—Ç–∞—Ç–µ–ª—å –¥–æ–≥–æ–≤–æ—Ä –≤—ã—Å–æ—Ç–∞ –ø–æ—ç—Ç —É—á–∞—Å—Ç–∏–µ –º–∞—Å—Ç–µ—Ä –≤—ã–≤–æ–¥ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–∞–º–µ—Ä–∞ –±–∏–ª–µ—Ç —É–¥–∞—Ä –ª–µ–∫—Ü–∏—è —Å–∞–ø–æ–≥ –æ–¥–µ–∂–¥–∞ –∑–µ—Ä–∫–∞–ª–æ –≤–∞–≥–æ–Ω –¥–∞—á–∞ —Ç—Ä—É–±–∞ –ø–∞–ª–µ—Ü –∫–æ—Ä–æ–ª—å —ç–Ω–µ—Ä–≥–∏—è —Å–∞–ª–æ–Ω –ø–æ–∫–æ–π –∫–æ–ª–µ–Ω–æ —Å—Ç–∞—Ä–∏–∫ —Å–µ—Å—Ç—Ä–∞ –≤—ã—Å–æ—Ç–∞ –≥–ª—É–±–∏–Ω–∞ –∑–≤–µ–∑–¥–∞ –∫—Ä—ã–ª–æ –ø—Ç–∏—Ü–∞ –ø–æ–ª–µ—Ç –∂—É—Ä–Ω–∞–ª —é–≥ –ª–µ–¥ –∞–¥—Ä–µ—Å –∫–æ–Ω–∫—É—Ä—Å —Å—Ü–µ–Ω–∞ –æ—Ö—Ä–∞–Ω–∞ —Ä–µ–≤–æ–ª—é—Ü–∏—è –∫—Ä—ã—à–∞ –æ–±–º–µ–Ω –∫–æ–ø–µ–π–∫–∞ —ç—Ç–∞–∂ —Ç–æ–ª–ø–∞ –ø–µ—Ä–µ—Ö–æ–¥ —Å–≤—è–∑—å –∫—Ä–∏–∑–∏—Å –º—ã—Å–ª—å —Ä–æ–º–∞–Ω –ø–∏—Å—Ç–æ–ª–µ—Ç –∫–∞—Ä–º–∞–Ω –º—è—Å–æ –ø–æ–ª—å–∑–∞ —É–¥–∏–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫ —Å–≤–∞–¥—å–±–∞ –º–µ—Ç–∞–ª–ª —Å—É–¥–Ω–æ —Ö–æ–∑—è–∏–Ω —Å–º–µ—Ö —è–±–ª–æ–∫–æ —Ç—Ä–∞–≤–∞ –∫–æ–ª–µ—Å–æ –ø—Ä–æ—Å–ø–µ–∫—Ç –ª–∞–≥–µ—Ä—å –≤–æ–∫–∑–∞–ª –∑–æ–ª–æ—Ç–æ –¥–µ—Ä–µ–≤–æ —Å–∞–ø–æ–≥ —Ä–æ–¥–∏–Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫ —Ç—Ä—É–ø —Å—É–º–∫–∞ —É–ª—ã–±–∫–∞ –¥–æ—Å–∫–∞ –ø—Ä–æ—Å—å–±–∞ –ø–æ–¥–∞—Ä–æ–∫ –¥—ã–º –ø–µ—Å–Ω—è –∏–Ω–∂–µ–Ω–µ—Ä –ø–µ–Ω—Å–∏—è —Å–∞–¥–∏—Ç—å—Å—è —Ç–∞–±–∞–∫ –∂–∞—Ä–∞ –≥—Ä—É–¥—å –∫—É—Ö–Ω—è –≤–∏–Ω–∞ –±–æ—Ç–∏–Ω–æ–∫ —Ä–æ–∂–¥–µ–Ω–∏–µ —Å–ø—É—Ç–Ω–∏–∫ –ª–∞–¥–æ–Ω—å —Å—Ç–∞–∫–∞–Ω –≥—É–±–∞ —Å—Ç–∞–¥–∏–æ–Ω –ø–∞–ø–∞ –≤—ã—Å—Ç—Ä–µ–ª —Å–ø–∏—Å–æ–∫ –±–µ–¥–∞ –∫—Ä–µ—Å–ª–æ –∫–æ—Ä–æ–≤–∞ –¥–æ–∂–¥—å –ø–æ–≥–æ–¥–∞ —è–π—Ü–æ —Å—Ç—Ä–∞—Ö –æ—à–∏–±–∫–∞ –±—É—Ç—ã–ª–∫–∞ –ø—Ä–æ–ø–∞—Å—Ç—å –º–æ–ª–æ–∫–æ —Å—É–ø –∑–∞–º–æ–∫ —Ç–∞—Ä–µ–ª–∫–∞ —Ç–µ–º–Ω–æ—Ç–∞ –ø–ª–∞—â –∫–æ—Ä–∞–±–ª—å —Ç–∞–Ω–∫ —Å—Ç—Ä–∞—Ö –∑–∞–ø–∞—Å —Ç—É—á–∞ –ø–ª–∞—Ç—å–µ –±–∏–ª–µ—Ç –≤–∞–≥–æ–Ω –±—É–º–∞–≥–∞ —Ö–æ–ª–º –ø–∞–∫–µ—Ç –ø–æ–¥–≤–∞–ª –≤–µ—Ä—Ç–æ–ª–µ—Ç
        `;

        let allWords = rawVocabulary.split(/\s+/).map(w => w.trim().toLowerCase()).filter(w => w.length > 0);
        const wordList = [...new Set(allWords)];

        let nLevel = 2;
        let maxRounds = 20;
        let history = [];
        let currentRound = 0;
        let attempts = 3;
        let isGameRunning = false;
        let isPaused = false;
        let needsInput = false;
        let gameTimer = null; 

        const setupScreen = document.getElementById('setup-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const wordDisplay = document.getElementById('word-display');
        const inputArea = document.getElementById('input-area');
        const nativeInput = document.getElementById('native-input');
        const attemptsBar = document.getElementById('attempts-bar');
        const waitMsg = document.getElementById('wait-msg');
        const feedbackMsg = document.getElementById('feedback-msg');
        const pauseOverlay = document.getElementById('pause-overlay');

        function showSetup() {
            clearTimeout(gameTimer);
            setupScreen.classList.remove('hidden');
            gameScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
        }

        function startGame() {
            nLevel = parseInt(document.getElementById('n-level').value);
            maxRounds = parseInt(document.getElementById('round-count').value);
            
            if (maxRounds > wordList.length) maxRounds = wordList.length;

            history = [];
            currentRound = 0;
            isGameRunning = true;
            isPaused = false;
            
            document.getElementById('display-n').innerText = nLevel;
            updateProgress();

            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            resultScreen.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            
            nextTurn();
        }

        function stopGame() {
            clearTimeout(gameTimer);
            isGameRunning = false;
            isPaused = false;
            nativeInput.blur();
            showSetup();
        }

        function togglePause() {
            if (!isGameRunning) return;
            isPaused = !isPaused;
            if (isPaused) {
                clearTimeout(gameTimer);
                pauseOverlay.classList.remove('hidden');
                nativeInput.blur(); 
            } else {
                pauseOverlay.classList.add('hidden');
                if (needsInput) {
                    nativeInput.focus();
                } else {
                     gameTimer = setTimeout(() => {
                        if(!isGameRunning || isPaused) return;
                        currentRound++;
                        updateProgress();
                        nextTurn();
                    }, 1000);
                }
            }
        }

        function nextTurn() {
            if (!isGameRunning) return;

            if (currentRound >= maxRounds) {
                endGame();
                return;
            }

            nativeInput.value = '';
            nativeInput.className = '';
            feedbackMsg.innerText = '';
            attempts = 3;
            updateHearts();

            let newWord = wordList[Math.floor(Math.random() * wordList.length)];
            history.push(newWord);
            
            needsInput = history.length > nLevel;

            wordDisplay.innerText = newWord;

            if (needsInput) {
                inputArea.classList.remove('hidden');
                waitMsg.classList.add('hidden');
                nativeInput.placeholder = `–°–ª–æ–≤–æ ${nLevel}-back`;
                setTimeout(() => {
                    if(!isPaused) {
                        nativeInput.focus();
                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª, —Ç–∞–∫ –∫–∞–∫ margin:auto —Å–ø—Ä–∞–≤–∏—Ç—Å—è –ª—É—á—à–µ
                    }
                }, 50);
            } else {
                inputArea.classList.add('hidden');
                waitMsg.classList.remove('hidden');
                nativeInput.blur();
                
                gameTimer = setTimeout(() => {
                    if(!isGameRunning || isPaused) return;
                    currentRound++;
                    updateProgress();
                    nextTurn();
                }, 3000); 
            }
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            if (!needsInput || isPaused) return;

            const userText = nativeInput.value.trim().toLowerCase();
            if (!userText) return;

            const targetIndex = history.length - 1 - nLevel;
            const targetWord = history[targetIndex].toLowerCase();

            const normalizedUser = userText.replace(/—ë/g, '–µ');
            const normalizedTarget = targetWord.replace(/—ë/g, '–µ');

            if (normalizedUser === normalizedTarget) {
                nativeInput.classList.add('input-success');
                feedbackMsg.innerText = "–í–µ—Ä–Ω–æ!";
                feedbackMsg.style.color = "var(--success-color)";
                needsInput = false;
                
                gameTimer = setTimeout(() => {
                    currentRound++;
                    updateProgress();
                    nextTurn();
                }, 600);
            } else {
                attempts--;
                updateHearts();
                nativeInput.classList.add('input-error');
                feedbackMsg.innerText = "–û—à–∏–±–∫–∞";
                feedbackMsg.style.color = "var(--error-color)";
                
                if (navigator.vibrate) navigator.vibrate(200);

                gameTimer = setTimeout(() => {
                    nativeInput.classList.remove('input-error');
                    nativeInput.value = '';
                }, 500);

                if (attempts <= 0) {
                    nativeInput.value = targetWord;
                    feedbackMsg.innerText = `–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${targetWord.toUpperCase()}`;
                    needsInput = false;
                    gameTimer = setTimeout(() => {
                        currentRound++;
                        updateProgress();
                        nextTurn();
                    }, 2500);
                }
            }
        }

        function updateHearts() {
            let h = "";
            for(let i=0; i < attempts; i++) {
                h += "üñ§ "; 
            }
            attemptsBar.innerText = h;
        }

        function updateProgress() {
            document.getElementById('progress').innerText = `${currentRound}/${maxRounds}`;
        }

        function endGame() {
            isGameRunning = false;
            nativeInput.blur();
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            document.getElementById('res-level').innerText = nLevel + "-Back";
            document.getElementById('final-score').innerText = maxRounds;
        }

    </script>
</body>
</html>