<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <title>N-Back Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1c1c1e;
            --text-main: #ffffff;
            --text-muted: #8e8e93;
            --accent-color: #0a84ff;
            --success-color: #30d158;
            --error-color: #ff453a;
            --input-bg: #2c2c2e;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Nunito', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        #app-viewport {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            padding: max(10px, env(safe-area-inset-top)) 20px max(10px, env(safe-area-inset-bottom)) 20px;
            transition: height 0.2s;
        }

        /* --- –ú–ï–ù–Æ --- */
        #setup-screen {
            flex: 1;
            width: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; 
        }
        #setup-screen::-webkit-scrollbar { display: none; }

        .menu-content {
            background: var(--card-bg);
            padding: 25px 20px; 
            border-radius: 24px;
            width: 100%; 
            max-width: 400px; 
            text-align: center;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            margin: auto 0;
            flex-shrink: 0;
            transition: margin 0.3s;
        }

        h1 { margin: 0 0 15px 0; color: var(--accent-color); font-size: 2.2rem; font-weight: 800; }

        .section-title {
            color: var(--text-muted); font-size: 0.8rem; font-weight: 800; 
            margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px;
        }

        .mode-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 5px;
        }
        
        .mode-btn {
            background: var(--input-bg); border: 2px solid transparent; color: var(--text-muted);
            padding: 12px; border-radius: 14px; font-size: 0.9rem; font-weight: 700;
            font-family: 'Nunito', sans-serif; cursor: pointer; transition: all 0.2s;
        }
        .mode-btn.active {
            background: rgba(10, 132, 255, 0.15); border-color: var(--accent-color); color: white;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ */
        .mode-btn.math-btn.active {
            background: rgba(48, 209, 88, 0.15); border-color: var(--success-color);
        }
        /* –°—Ç–∏–ª—å –¥–ª—è —Å—É–ø–µ—Ä-–º–∏–∫—Å–∞ */
        .mode-btn.super-btn {
            grid-column: span 2; /* –ù–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
            background: linear-gradient(45deg, #2c2c2e, #3a3a3c);
        }
        .mode-btn.super-btn.active {
            background: linear-gradient(45deg, rgba(10, 132, 255, 0.2), rgba(48, 209, 88, 0.2));
            border-color: #ffffff;
        }

        .setup-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-group { flex: 1; display: flex; flex-direction: column; align-items: center; }
        label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 5px; font-weight: 700; }
        
        input[type="number"] {
            background: var(--input-bg); border: none; color: white;
            padding: 12px; border-radius: 14px; font-size: 1.2rem;
            width: 100%; text-align: center; font-family: 'Nunito', sans-serif; font-weight: 700;
        }

        button.main-btn {
            background-color: var(--accent-color); color: white; font-weight: 800;
            border: none; padding: 16px; font-size: 1.2rem; border-radius: 18px;
            width: 100%; cursor: pointer; margin-top: 20px;
        }
        button.main-btn:active { opacity: 0.8; transform: scale(0.98); }

        .spacer { height: 0px; transition: height 0.3s; }
        .keyboard-open .spacer { height: 250px; } 

        /* --- –ò–ì–†–ê --- */
        #game-screen {
            flex: 1; display: flex; flex-direction: column; width: 100%; height: 100%;
            padding: 0 20px 20px 20px;
        }

        .header {
            display: grid; grid-template-columns: 44px 1fr 44px; align-items: center;
            flex: 0 0 auto; margin: 10px 0;
        }

        .control-btn {
            background: #2c2c2e; border: none; color: var(--text-muted);
            width: 44px; height: 44px; border-radius: 50%; font-size: 1.1rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-family: 'Nunito', sans-serif;
        }

        .info-center { display: flex; flex-direction: column; align-items: center; justify-content: center; line-height: 1.3; }
        #timer, .stats-line { font-size: 0.95rem; font-weight: 700; color: var(--text-muted); font-variant-numeric: tabular-nums; }
        #timer { margin-bottom: 2px; }

        .game-area {
            flex: 1 1 auto; display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative; min-height: 0;
        }

        #word-card {
            background: var(--card-bg); border-radius: 24px; width: 100%; max-width: 400px;
            height: 60%; max-height: 220px; min-height: 160px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin-bottom: 20px; position: relative;
        }

        #word-index {
            position: absolute; top: 15px; width: 100%; text-align: center;
            font-size: 1.5rem; font-weight: 800; 
            color: var(--text-muted); opacity: 0.5;
            line-height: 1;
        }

        #word-display {
            font-size: 2.5rem; font-weight: 800; color: #fff;
            text-transform: uppercase; margin: 0; text-align: center;
            word-break: break-word; hyphens: auto; line-height: 1;
        }
        .countdown-big { font-size: 5rem !important; color: var(--text-muted) !important; opacity: 0.5; }

        #card-timer {
            position: absolute; bottom: 10px; width: 100%; text-align: center;
            color: var(--text-muted); opacity: 0.5;
            font-size: 1.5rem; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1;
        }

        .input-wrapper {
            flex: 0 0 auto; width: 100%; max-width: 400px; margin: 0 auto; padding-bottom: 10px; 
        }

        #attempts-bar { 
            text-align: center; margin-bottom: 10px; font-size: 1.6rem; letter-spacing: 5px; height: 30px; opacity: 0.9; 
        }

        #game-form { 
            width: 100%; display: flex; gap: 10px;
        }

        #native-input {
            flex: 1;
            padding: 14px; font-size: 1.5rem; 
            background-color: var(--input-bg); border: 3px solid #3a3a3c; border-radius: 18px;
            color: white; text-align: center; box-sizing: border-box; outline: none;
            -webkit-appearance: none; font-family: 'Nunito', sans-serif; font-weight: 800;
        }
        #native-input:focus { border-color: var(--accent-color); background-color: #303033; }
        
        #submit-btn {
            width: 60px;
            background-color: var(--accent-color);
            border: none; border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: white; font-size: 1.5rem; flex-shrink: 0;
        }
        #submit-btn:active { opacity: 0.8; transform: scale(0.95); }

        .input-error { border-color: var(--error-color) !important; animation: shake 0.4s; }
        .input-success { border-color: var(--success-color) !important; }

        .hidden { display: none !important; }

        #pause-overlay, #result-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
            padding: 20px;
        }
        #result-screen { background: var(--bg-color); z-index: 60; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }
    </style>
</head>
<body>

    <div id="app-viewport">
        
        <div id="setup-screen">
            <div class="menu-content">
                <div class="section-title" style="margin-top:0">–°–ª–æ–≤–∞</div>
                <div class="mode-grid">
                    <button class="mode-btn active" onclick="setMode('noun', this)">–ü—Ä–µ–¥–º–µ—Ç—ã</button>
                    <button class="mode-btn" onclick="setMode('verb', this)">–ì–ª–∞–≥–æ–ª—ã</button>
                    <button class="mode-btn" onclick="setMode('adj', this)">–ü—Ä–∏–∑–Ω–∞–∫–∏</button>
                    <button class="mode-btn" onclick="setMode('mix', this)">–ú–∏–∫—Å</button>
                </div>

                <div class="section-title">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
                <div class="mode-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                    <button class="mode-btn math-btn" onclick="setMode('math_table', this)">–¢–∞–±–ª–∏—Ü–∞</button>
                    <button class="mode-btn math-btn" onclick="setMode('math100', this)">1-100</button>
                    <button class="mode-btn math-btn" onclick="setMode('math500', this)">100-500</button>
                </div>
                
                <div class="mode-grid" style="grid-template-columns: 1fr; margin-top: 5px;">
                    <button class="mode-btn super-btn" onclick="setMode('super_mix', this)">–°–£–ü–ï–†-–ú–ò–ö–° (–°–ª–æ–≤–∞ + –ú–∞—Ç.)</button>
                </div>

                <div class="setup-row" style="margin-top:20px;">
                    <div class="input-group">
                        <label>–£—Ä–æ–≤–µ–Ω—å N</label>
                        <input type="number" id="n-level" value="2" min="1" max="10" onfocus="onInputFocus(this)" onblur="onInputBlur()">
                    </div>
                    <div class="input-group">
                        <label>–û—Ç–≤–µ—Ç–æ–≤</label>
                        <input type="number" id="round-count" value="20" min="5" max="200" onfocus="onInputFocus(this)" onblur="onInputBlur()">
                    </div>
                    <div class="input-group">
                        <label>–í—Ä–µ–º—è (—Å–µ–∫)</label>
                        <input type="number" id="memo-time" value="3" min="1" max="10" onfocus="onInputFocus(this)" onblur="onInputBlur()">
                    </div>
                </div>
                
                <button class="main-btn" onclick="startGame()">–ù–ê–ß–ê–¢–¨</button>
            </div>
            <div class="spacer"></div>
        </div>

        <div id="game-screen" class="hidden">
            <div class="header">
                <button class="control-btn" onclick="stopGame()">‚úï</button>
                <div class="info-center">
                    <div id="timer">00:00</div>
                    <div class="stats-line">
                        <span id="display-n">2</span>-Back ‚Ä¢ <span id="progress">0/25</span>
                    </div>
                </div>
                <button class="control-btn" onclick="togglePause()">II</button>
            </div>

            <div class="game-area">
                <div id="word-card" class="hidden">
                    <div id="word-index" class="hidden">1</div>
                    <div id="word-display">...</div>
                    <div id="card-timer" class="hidden">3</div>
                </div>
                <div id="wait-msg" style="color: #777; font-size: 1.2rem; font-weight: 700;" class="hidden">–ó–∞–ø–æ–º–∏–Ω–∞–µ–º...</div>
            </div>

            <div class="input-wrapper">
                <div id="input-area" class="hidden">
                    <div id="attempts-bar">üñ§ üñ§ üñ§</div>
                    <form id="game-form" autocomplete="off" onsubmit="handleFormSubmit(event)">
                        <input type="text" id="native-input" placeholder="–í–≤–æ–¥" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" enterkeyhint="go">
                        <button type="submit" id="submit-btn">‚ûî</button>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <div id="pause-overlay" class="hidden">
        <h2 style="color:white; margin-bottom:30px; font-size: 2rem; font-weight: 800;">–ü–ê–£–ó–ê</h2>
        <button class="main-btn" style="width: 70%; max-width: 300px;" onclick="togglePause()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
        <button class="main-btn" style="width: 70%; max-width: 300px; background:#333; margin-top:15px;" onclick="stopGame()">–í –ú–ï–ù–Æ</button>
    </div>

    <div id="result-screen" class="hidden">
        <div class="menu-content" style="margin: auto;">
            <h1 style="color: var(--success-color)">–ì–æ—Ç–æ–≤–æ!</h1>
            <div style="background: #252525; padding: 25px; border-radius: 20px; margin: 25px 0;">
                <p style="margin: 8px 0; color:#aaa; font-size: 1.2rem; font-weight:700;">–£—Ä–æ–≤–µ–Ω—å: <b style="color:white" id="res-level"></b></p>
                <p style="margin: 8px 0; color:#aaa; font-size: 1.2rem; font-weight:700;">–û—Ç–≤–µ—Ç–æ–≤: <b style="color:white" id="final-score"></b></p>
                <p style="margin: 8px 0; color:#aaa; font-size: 1.2rem; font-weight:700;">–í—Ä–µ–º—è: <b style="color:white" id="final-time"></b></p>
            </div>
            <button class="main-btn" onclick="showSetup()">–ú–ï–ù–Æ</button>
        </div>
    </div>

    <script>
        const viewport = window.visualViewport;
        const appContainer = document.getElementById('app-viewport');
        function resizeHandler() {
            if (!viewport) return;
            appContainer.style.height = `${viewport.height}px`;
            window.scrollTo(0, 0);
        }
        if (viewport) {
            viewport.addEventListener('resize', resizeHandler);
            viewport.addEventListener('scroll', resizeHandler);
            resizeHandler();
        }

        // --- –ë–ê–ó–´ –°–õ–û–í ---
        const vocabNouns = `–≥–æ–¥ —á–µ–ª–æ–≤–µ–∫ –≤—Ä–µ–º—è –¥–µ–ª–æ –∂–∏–∑–Ω—å –¥–µ–Ω—å —Ä—É–∫–∞ —Ä–∞–∑ —Ä–∞–±–æ—Ç–∞ —Å–ª–æ–≤–æ –º–µ—Å—Ç–æ –ª–∏—Ü–æ –¥—Ä—É–≥ –≥–ª–∞–∑ –≤–æ–ø—Ä–æ—Å –¥–æ–º —Å—Ç–æ—Ä–æ–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ –º–∏—Ä —Å–ª—É—á–∞–π –≥–æ–ª–æ–≤–∞ —Ä–µ–±–µ–Ω–æ–∫ —Å–∏–ª–∞ –∫–æ–Ω–µ—Ü –≤–∏–¥ —Å–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç—å –≥–æ—Ä–æ–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∂–µ–Ω—â–∏–Ω–∞ –¥–µ–Ω—å–≥–∏ –∑–µ–º–ª—è –º–∞—à–∏–Ω–∞ –≤–æ–¥–∞ –æ—Ç–µ—Ü –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∞–≤–æ –Ω–æ–≥–∞ —Ä–µ—à–µ–Ω–∏–µ –¥–≤–µ—Ä—å –æ–±—Ä–∞–∑ –∏—Å—Ç–æ—Ä–∏—è –≤–ª–∞—Å—Ç—å –∑–∞–∫–æ–Ω –≤–æ–π–Ω–∞ –±–æ–≥ –≥–æ–ª–æ—Å —Ç—ã—Å—è—á–∞ –∫–Ω–∏–≥–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–æ—á—å —Å—Ç–æ–ª –∏–º—è –æ–±–ª–∞—Å—Ç—å —Å—Ç–∞—Ç—å—è —á–∏—Å–ª–æ –∫–æ–º–ø–∞–Ω–∏—è –Ω–∞—Ä–æ–¥ –∂–µ–Ω–∞ –≥—Ä—É–ø–ø–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ—Ü–µ—Å—Å —É—Å–ª–æ–≤–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–æ —Å–≤–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ —Å–æ–ª–Ω—Ü–µ –ª—é–±–æ–≤—å —Å–ª—É—Ö –ø—Ä–æ–µ–∫—Ç —á–∞—Å –ø–æ—Ä—è–¥–æ–∫ –ø—É—Ç—å –¥—É—à–∞ –ø–æ–º–æ—â—å —Ä—ã–Ω–æ–∫ –æ—á–µ—Ä–µ–¥—å –ø–∏—Å—å–º–æ –∞—Ä–º–∏—è –≤–µ–∫ —Ö–æ–¥ —è–∑—ã–∫ —Ä—è–¥ –¥–≤–∏–∂–µ–Ω–∏–µ –æ–≥–æ–Ω—å –¥–∏—Ä–µ–∫—Ç–æ—Ä —Å—Ç–µ–Ω–∞ –≤—Å—Ç—Ä–µ—á–∞ —Ü–µ–ª—å —à–∫–æ–ª–∞ –ø–ª–∞–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–æ–∑–¥—É—Ö –∏–Ω—Ç–µ—Ä–µ—Å —Å–º–µ—Ä—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–¥–∞—á–∞ –æ–ø—ã—Ç —Ç–µ–ª–æ –∏–≥—Ä–∞ –ª–µ—Å –¥–≤–æ—Ä –æ–∫–Ω–æ —Ü–µ–Ω—Ç—Ä —Å–µ–º—å—è –ø–ª–µ—á–æ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç –≤—Ä–∞—á –Ω–æ–º–µ—Ä —Å—É–¥ —É–≥–æ–ª —É—á–∏—Ç–µ–ª—å —Ä–∞–π–æ–Ω –Ω–µ–±–æ —Å–æ–≤–µ—Ç –∑–æ–ª–æ—Ç–æ –º—É–∑—ã–∫–∞ –ø–∞–º—è—Ç—å –≥—Ä–∞–Ω–∏—Ü–∞ –∑–Ω–∞–∫ —Ñ–æ—Ä–º–∞ —Å–æ–±–∞–∫–∞ –∫–∞–º–µ–Ω—å –±–æ–ª—å —Å—ã–Ω –º—ã—Å–ª—å —Å–ø–æ—Ä—Ç –≥–µ—Ä–æ–π –¥–µ—Ä–µ–≤–æ –∑–¥–∞–Ω–∏–µ —Å–≤—è–∑—å –ø–æ—ç—Ç —Å–Ω–µ–≥ —Å–æ–Ω —ç–ª–µ–º–µ–Ω—Ç —É—Ö–æ –≤–µ—Ä–∞ –æ—Å—Ç—Ä–æ–≤ –±–∞–Ω–∫ —Ä–∞—Å—Ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª –≤–æ–ª—è —Å–∞–¥ –∫—É—Ä—Å —Ä–µ–∫–∞ –º—É–∂–∏–∫ —Ä–æ—Ç –∫—Ä–∞–π –º–æ—Å—Ç –ª–∏—Å—Ç —á–µ—Å—Ç—å –∞–≤—Ç–æ—Ä –≤–µ—á–µ—Ä —Ü–≤–µ—Ç –ø–æ–ª–∫ —Ä–∞–¥–æ—Å—Ç—å –ø—Ç–∏—Ü–∞ –∫—Ä—É–≥ —Ç—Ä—É–ø —Å–º—ã—Å–ª –º–∞—Å–ª–æ –¥–æ–∂–¥—å —ç–∫—Ä–∞–Ω —Å–ª–µ–∑–∞ –∑–≤–µ—Ä—å –∫–æ–Ω–∫—É—Ä—Å —Ç–∞–Ω–µ—Ü –Ω–æ—Å –∫–æ—Ä–µ–Ω—å –ø–µ—Å–Ω—è –∫–ª–∞—Å—Å –∑–∞–≤–æ–¥ —É–¥–∞—Ä –ª–∏–¥–µ—Ä —ç—Ç–∞–ø –±—Ä–∞—Ç —Å—Ç—É–ª —à—Ç–∞–± –∑–≤—É–∫ –¥–µ–¥ –º–µ—Ç—Ä –ø–µ—Å–æ–∫ —Å—Ç–∏—Ö —Ö–ª–µ–± —Ñ–∏–ª—å–º —Ä—É–±–ª—å —à–∞–Ω—Å —Ç–∏–ø —Å–º–µ—Ö –º–æ—Ä–µ –∑–æ–Ω–∞ —Ç–æ–≤–∞—Ä –∫—É—Å–æ–∫ —Å–ª—É–∂–±–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä –≤–æ–∑—Ä–∞—Å—Ç —Ä—ã–±–∞ —Ä–æ—Å—Ç —Å—Ü–µ–Ω–∞ –∫—Ä—ã—à–∞ –ø–æ–∏—Å–∫ –¥–æ–ª–≥ –≤–æ–∂–¥—å –º–æ–∑–≥ –∏—Ç–æ–≥ –ø–∏–≤–æ —á–∞–π –≥—É–±–∞ –¥—è–¥—è —á–µ—Ä—Ç –∫–æ–Ω—å —à–µ—è —Ç–∞–Ω–∫ –∫–∞–¥—Ä —Å–ª–æ–π —Å–ø–æ—Ä –≤–∫—É—Å —Å–ª–µ–¥ —Ç–æ–ª–ø–∞ –≤—Ö–æ–¥ —Ä–∏—Å–∫ —É–∫–∞–∑ –∑–∏–º–∞ –º–æ–¥–∞ —à—É–º –ª–µ—Ç–æ –ø–æ—Å—Ç —Å–±–æ—Ä –∫—É—Å—Ç –æ–±–µ–¥ –≤—Ä–µ–¥ —à–∞—Ä—Ñ –ø–∞—É–∫ —Å–ª–æ–Ω —Ü–∏—Ä–∫ –±–∞–∫ –±–æ–∫—Å –≤–∏–Ω—Ç –≥—Ä–∏–± –∑–æ–Ω—Ç –∫–ª–æ–ø –∫–ª–µ–π –ª–∏—Ñ—Ç –ø—É–ª—è —Ç–æ—Ä—Ç —Ñ–ª–∞–≥ —Ü–µ–ø—å —à–∏–Ω–∞ —é–±–∫–∞ —è—â–∏–∫ –≥—Ä–æ–º —Ö–æ–ª–º —Ç–∏–≥—Ä –≤–æ–ª–∫ –±–∞—Ä—Å —Ä—ã—Å—å –∫—Ä–∞–± –æ–º–∞—Ä —Å–∫–∞—Ç –∫–∏—Ç –º–æ—Ä–∂ –ø–æ–Ω–∏ –æ–≤—Ü–∞ –∫–æ–∑–∞ –ª–æ—Å—å –µ–Ω–æ—Ç –∫—Ä–æ—Ç –º—ã—à—å —Å–æ–≤–∞ –≥—É—Å—å —É—Ç–∫–∞ –∞–∏—Å—Ç –≥—Ä–∞—á —Å—Ç—Ä–∏–∂ —É–¥–∞–≤ –æ—Å–∞ –º—É—Ö–∞ –±–ª–æ—Ö–∞ –∫–ª–µ—â –º–æ–ª—å —Ä–∞–∫ —â—É–∫–∞ –∫–∞—Ä–ø —Å–æ–º –ª–∏–Ω—å –∞–≥–∞—Ç –∞–ª–º–∞–∑ –±–æ–ª—Ç –≥–∏–ø—Å –¥–µ—Ä–Ω –∂–µ—Å—Ç—å –∏–≥–ª–∞ –∫–æ–≤—à –ª–æ–º –º–∞—è–∫ –Ω–æ–∂ –ø–ª—É–≥ —Ä—É–ª—å —Å–µ—Ç—å —Ç—Ä–æ—Å —É–∑–µ–ª —à–∏–ø —â–∏—Ç —è–∫–æ—Ä—å –∞–∑–æ—Ç –±—Ä–æ–º –≤–æ—Å–∫ –≥–∞–∑ –≥–µ–ª—å –¥—ã–º –π–æ–¥ –ª–∞–∫ –º–µ–ª –ø–∞—Ä –ø—É—Ö —Å–∞–∂–∞ —Å–æ–ª—å —Ç–æ—Ä—Ñ —É—Ä–∞–Ω —Ö—Ä–æ–º —Ü–∏–Ω–∫ —à–ª–∞–∫ –±–æ—Ä –≤—è–∑ –¥—É–± –∏–≤–∞ –∫–µ–¥—Ä –∫–ª–µ–Ω –ª–∏–ø–∞ –ø–∞–ª—å–º–∞ —Ä–æ–∑–∞ –∞–ª–æ—ç –º–∞–∫ –ø–∏–æ–Ω –∏—Ä–∏—Å –∞–Ω–∏—Å –±–æ–± –ª—É–∫ —Ä–∞–ø—Å —Ä–∏—Å —Å–æ—è —Ç—ã–∫–≤–∞ —É–∫—Ä–æ–ø —Ö–≤–æ—â —à–ø–∏–Ω–∞—Ç –≤–µ–Ω–∞ –≤–µ–∫–æ –¥–µ—Å–Ω–∞ –∂–∏–ª–∞ –∑—É–± –∫–æ–∂–∞ –∫–æ—Å—Ç—å –Ω–µ—Ä–≤ –Ω–æ–≥–æ—Ç—å –ø—É–ø —Ä–µ–±—Ä–æ —Ç–∞–∑ —á–µ—Ä–µ–ø –±–∏–Ω—Ç –≤–∞—Ç–∞ –∂–≥—É—Ç –º–∞–∑—å –∑–æ–Ω–¥ –∫–ª–∏–∑–º–∞ –æ—á–∫–∏ —à–ø—Ä–∏—Ü –≥–∏–º–Ω –¥–∂–∞–∑ –º–∞—Ä—à –Ω–æ—Ç–∞ –æ–ø–µ—Ä–∞ –æ–ø—É—Å —Ä–∏—Ç–º —Å–æ–ª–æ —Ç—É—à —Ö–æ—Ä –±–∞–ª–ª –≥–µ–π–º –≥–æ–ª –ø–∞—Å —Å–µ—Ç —Ñ–∏–Ω—Ç —à–∞—Ö –º–∞—Ç –∫—Ä–æ—Å—Å —Å—Ç–∞—Ä—Ç —Ç—Ä–µ–∫ —è–º–± —Ö–æ—Ä–µ–π —Å—Ç–æ–ø–∞ —Å–ª–æ–≥ —ç–ø–æ—Å –º–∏—Ñ –æ–¥–∞ —Å–∫–∞–∑ –∂–∞–Ω—Ä —Å—Ç–∏–ª—å —Ç–µ–º–∞ —Ç–æ–º –±–æ—Ç –±—Ä–∏–≥ –ø–ª–æ—Ç –ø–æ—Ä—Ç —Ç—Ä–∞–ø —Ç—Ä—é–º —à–ª—é–∑ —è–ª–∏–∫ –∫—Ä–∞—Ö –∫—Ä–∏–∑–∏—Å –Ω–∞–ª–æ–≥ —Å–±—ã—Ç —Ç–æ—Ä–≥ —Ü–µ–Ω–∞ —á–µ–∫ —à—Ç—Ä–∞—Ñ –≤–∏–∑–∞ –∏—Å–∫ –∫–æ–¥–µ–∫—Å —É—Å—Ç–∞–≤ —Ü–µ–Ω–∑ —à—Ç–∞—Ç –±—Ä–∞–∫ –≤–Ω—É–∫ –≤–¥–æ–≤–∞ –∑—è—Ç—å –∫—É–º —Å–≤–∞—Ç —Ç–µ—Å—Ç—å —Ç–µ—Ç—è –∞—Ç–æ–º –≤–∞—Ç—Ç –≤–æ–ª—å—Ç –¥–∂–æ—É–ª—å –∏–æ–Ω –∫–∞—Ç–æ–¥ –∫–≤–∞–Ω—Ç –æ–º —Ñ–∞–∑–∞ —Ñ–æ–Ω —ç—Ö–æ –∞–Ω–æ–¥ –¥–∏–æ–¥ –ª–∞–º–ø–∞ –ª—É—á —Ä–µ–ª–µ —Ç–æ–∫ —â—É–ø`;
        const vocabVerbs = `–±—ã—Ç—å –º–æ—á—å —Å–∫–∞–∑–∞—Ç—å –≥–æ–≤–æ—Ä–∏—Ç—å –∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—å –µ—Å—Ç—å —Ö–æ—Ç–µ—Ç—å –≤–∏–¥–µ—Ç—å –∏–¥—Ç–∏ –¥—É–º–∞—Ç—å —Å–ø—Ä–æ—Å–∏—Ç—å –∂–∏—Ç—å —Å–º–æ—Ç—Ä–µ—Ç—å —Å–∏–¥–µ—Ç—å –∏–º–µ—Ç—å –¥–µ–ª–∞—Ç—å –≤–∑—è—Ç—å –ø–æ–Ω—è—Ç—å –∫–∞–∑–∞—Ç—å—Å—è –¥–∞–≤–∞—Ç—å –ø–æ–π—Ç–∏ —É–≤–∏–¥–µ—Ç—å –¥–∞—Ç—å –ø–∏—Å–∞—Ç—å –∂–¥–∞—Ç—å –Ω–∞–π—Ç–∏ –æ—Å—Ç–∞—Ç—å—Å—è —Ä–µ—à–∏—Ç—å –≤—ã–π—Ç–∏ –ø—Ä–æ–π—Ç–∏ –ø–∏—Å–∞—Ç—å –ø–æ–º–Ω–∏—Ç—å —Å—Ç–æ—è—Ç—å —Å–ª—É—à–∞—Ç—å –≤–µ—Ä–∏—Ç—å –∫—É–ø–∏—Ç—å —É–π—Ç–∏ –Ω–∞—á–∞—Ç—å —á–∏—Ç–∞—Ç—å —Å–ª—ã—à–∞—Ç—å –ª—é–±–∏—Ç—å –æ—Ç–≤–µ—á–∞—Ç—å —Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å–ø–∞—Ç—å –∑–≤–∞—Ç—å –ø—Ä–æ—Å–∏—Ç—å –∏–≥—Ä–∞—Ç—å –ª–µ–∂–∞—Ç—å —Ö–æ–¥–∏—Ç—å –ø–æ–º–æ—á—å –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–∫—Ä—ã—Ç—å –Ω–∞—á–∞—Ç—å —Ç–µ—Ä—è—Ç—å –¥–µ—Ä–∂–∞—Ç—å –Ω–∞–π—Ç–∏ –º–µ–Ω—è—Ç—å –∑–∞–±—ã—Ç—å –∏—Å–∫–∞—Ç—å –≤–µ—Å—Ç–∏ –ø–ª–∞—Ç–∏—Ç—å –ø—Ä–æ—Å—Ç–∏—Ç—å —É—á–∏—Ç—å –∫—Ä–∏—á–∞—Ç—å –±–æ—è—Ç—å—Å—è –ø–∞–¥–∞—Ç—å —Å–∞–¥–∏—Ç—å—Å—è –≤—Å—Ç–∞—Ç—å –º–æ–ª—á–∞—Ç—å —Å–ø–µ—à–∏—Ç—å –ø–∏—Ç—å –±–µ–∂–∞—Ç—å –ª–æ–≤–∏—Ç—å –±–∏—Ç—å –≥–æ—Ä–µ—Ç—å –µ—Ö–∞—Ç—å –ª–µ—Ç–µ—Ç—å –ø–µ—Ç—å —Å–º–µ—è—Ç—å—Å—è –∂–µ–ª–∞—Ç—å –±—Ä–æ—Å–∏—Ç—å –ø–ª–∞–∫–∞—Ç—å —Å—Ç—Ä–æ–∏—Ç—å –ª–æ–º–∞—Ç—å –Ω–æ—Å–∏—Ç—å —Ç—è–Ω—É—Ç—å –¥—ã—à–∞—Ç—å —Ö–≤–∞—Ç–∞—Ç—å —Å–ø–∞—Å—Ç–∏ —Ä–∞—Å—Ç–∏ –∑–≤–∞—Ç—å –≤–µ–∑—Ç–∏ –±–µ—Ä–µ—á—å –¥–∞—Ä–∏—Ç—å –ª–µ—á–∏—Ç—å —É—á–∏—Ç—å –∂–∞–ª–µ—Ç—å –≤–∞—Ä–∏—Ç—å –∂–∞—Ä–∏—Ç—å –ø–µ—á—å —à–∏—Ç—å –º—ã—Ç—å –±—Ä–∏—Ç—å –ª–∏—Ç—å –¥—É—Ç—å –≥–Ω—É—Ç—å –≥—Ä–µ—Ç—å —Ç–µ—Ä–µ—Ç—å –≤–∏—Å–µ—Ç—å –±–ª–µ—Å—Ç–µ—Ç—å —à—É–º–µ—Ç—å –∑–≤–µ–Ω–µ—Ç—å –≥—Ä–µ–º–µ—Ç—å —Å—Ç—É—á–∞—Ç—å —Å–∫—Ä–∏–ø–µ—Ç—å –ø–∏—â–∞—Ç—å –∂—É–∂–∂–∞—Ç—å —Ä—ã—á–∞—Ç—å –º—ã—á–∞—Ç—å –ª–∞—è—Ç—å –º—è—É–∫–∞—Ç—å –∫—É—Å–∞—Ç—å –∫–ª–µ–≤–∞—Ç—å –±–æ–¥–∞—Ç—å –∂–∞–ª–∏—Ç—å –∫–æ–ª–æ—Ç—å —Ä–µ–∑–∞—Ç—å —Ä—É–±–∏—Ç—å –ø–∏–ª–∏—Ç—å –∫–æ–ø–∞—Ç—å –ø–∞—Ö–∞—Ç—å —Å–µ—è—Ç—å –∂–∞—Ç—å –≤–µ—è—Ç—å –º–æ–ª–æ—Ç—å –∫–æ—Å–∏—Ç—å –≥—Ä–µ—Å—Ç–∏ –≤–µ–∑—Ç–∏ –Ω–µ—Å—Ç–∏ –≤–µ—Å—Ç–∏ –ø–æ–ª–∑—Ç–∏ –ª–µ–∑—Ç—å –ø–ª—ã—Ç—å –±—Ä–µ—Å—Ç–∏ —Ü–≤–µ—Å—Ç–∏ –ø–∞—Ö–Ω—É—Ç—å –≤—è–Ω—É—Ç—å –∫–∏—Å–Ω—É—Ç—å –º–æ–∫–Ω—É—Ç—å —Å–æ—Ö–Ω—É—Ç—å –º–µ—Ä–∑–Ω—É—Ç—å –∑—è–±–Ω—É—Ç—å —Å—Ç—ã–Ω—É—Ç—å —Å–ª–µ–ø–Ω—É—Ç—å –≥–ª–æ—Ö–Ω—É—Ç—å –ø—É—Ö–Ω—É—Ç—å –≥–∞—Å–Ω—É—Ç—å –ª–∏–ø–Ω—É—Ç—å –≤–∏—Å–Ω—É—Ç—å —Ç–æ–Ω—É—Ç—å –≥–∏–±–Ω—É—Ç—å –∫—Ä–µ–ø–Ω—É—Ç—å —Ö—Ä–∏–ø–Ω—É—Ç—å —Å–∏–ø–Ω—É—Ç—å –æ—Ö–Ω—É—Ç—å –∞—Ö–Ω—É—Ç—å —Ç–æ–ø–Ω—É—Ç—å —Ö–ª–æ–ø–Ω—É—Ç—å —Å–≤–∏—Å—Ç–Ω—É—Ç—å –ø—Ä—ã–≥–Ω—É—Ç—å —à–∞–≥–Ω—É—Ç—å –∫–∏–≤–Ω—É—Ç—å –º–∞—Ö–Ω—É—Ç—å –º–∏–≥–Ω—É—Ç—å –∑–µ–≤–∞—Ç—å —á–∏—Ö–∞—Ç—å –∫–∞—à–ª—è—Ç—å –∏–∫–∞—Ç—å —Å—Ç–æ–Ω–∞—Ç—å —Ö—Ä–∞–ø–µ—Ç—å —Å–æ–ø–µ—Ç—å —Å–∏–ø–µ—Ç—å —Ö—Ä–∏–ø–µ—Ç—å –≥—É–¥–µ—Ç—å –∑—É–¥–µ—Ç—å –±–æ–ª–µ—Ç—å —Ç–µ—Ä–ø–µ—Ç—å –≤–µ—Ä—Ç–µ—Ç—å –≥–ª—è–¥–µ—Ç—å –ª–µ—Ç–µ—Ç—å —Å–≤–∏—Å—Ç–µ—Ç—å —Ö—Ä—É—Å—Ç–µ—Ç—å —à–µ–ª–µ—Å—Ç–µ—Ç—å —à—É—Ä—à–∞—Ç—å –≤–æ—Ä—á–∞—Ç—å –±—É—Ä—á–∞—Ç—å –∂—É—Ä—á–∞—Ç—å –∑–≤—É—á–∞—Ç—å –º–æ–ª—á–∞—Ç—å –∫—Ä–∏—á–∞—Ç—å –≤–∏–∑–∂–∞—Ç—å –≤–µ—Ä–µ—â–∞—Ç—å —Ç—Ä–µ—â–∞—Ç—å –ø–∏—â–∞—Ç—å —Ä—ã—á–∞—Ç—å —Å—Ç—É—á–∞—Ç—å –±—Ä–µ–Ω—á–∞—Ç—å –±—Ä–∏–Ω—á–∞—Ç—å –∑–≤—è–∫–∞—Ç—å –±—Ä—è–∫–∞—Ç—å –∫–≤–∞–∫–∞—Ç—å –∫–∞—Ä–∫–∞—Ç—å —á–∏—Ä–∏–∫–∞—Ç—å –∫—É–∫–æ–≤–∞—Ç—å –∫—É—Ä–ª—ã–∫–∞—Ç—å –º—É—Ä–ª—ã–∫–∞—Ç—å –∫—É–¥–∞—Ö—Ç–∞—Ç—å –≥–æ–≥–æ—Ç–∞—Ç—å —Ö–æ—Ö–æ—Ç–∞—Ç—å —Ö–∏—Ö–∏–∫–∞—Ç—å —à–µ–ø—Ç–∞—Ç—å –ª–µ–ø–µ—Ç–∞—Ç—å –±–æ—Ä–º–æ—Ç–∞—Ç—å –ª–æ–ø–æ—Ç–∞—Ç—å –º—è–º–ª–∏—Ç—å`;
        const vocabAdj = `–±–æ–ª—å—à–æ–π –º–∞–ª–µ–Ω—å–∫–∏–π –Ω–æ–≤—ã–π —Å—Ç–∞—Ä—ã–π —Ö–æ—Ä–æ—à–∏–π –ø–ª–æ—Ö–æ–π –±–µ–ª—ã–π —á–µ—Ä–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π —Å–∏–Ω–∏–π –∑–µ–ª–µ–Ω—ã–π –∂–µ–ª—Ç—ã–π –¥–æ–±—Ä—ã–π –∑–ª–æ–π —É–º–Ω—ã–π –≥–ª—É–ø—ã–π –≤–µ—Å–µ–ª—ã–π –≥—Ä—É—Å—Ç–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π –ª–µ–≥–∫–∏–π —Ç—è–∂–µ–ª—ã–π –º—è–≥–∫–∏–π —Ç–≤–µ—Ä–¥—ã–π —Ç–µ–ø–ª—ã–π —Ö–æ–ª–æ–¥–Ω—ã–π –≥–æ—Ä—è—á–∏–π —Å–≤–µ–∂–∏–π —á–µ—Ä—Å—Ç–≤—ã–π —Å—É—Ö–æ–π –º–æ–∫—Ä—ã–π —á–∏—Å—Ç—ã–π –≥—Ä—è–∑–Ω—ã–π –¥–æ—Ä–æ–≥–æ–π –¥–µ—à–µ–≤—ã–π –±–æ–≥–∞—Ç—ã–π –±–µ–¥–Ω—ã–π —Å–∏–ª—å–Ω—ã–π —Å–ª–∞–±—ã–π –±–æ–ª—å–Ω–æ–π –∑–¥–æ—Ä–æ–≤—ã–π –ø—Ä–∞–≤—ã–π –ª–µ–≤—ã–π –∂–∏–≤–æ–π –º–µ—Ä—Ç–≤—ã–π –≥—Ä–æ–º–∫–∏–π —Ç–∏—Ö–∏–π –¥–ª–∏–Ω–Ω—ã–π –∫–æ—Ä–æ—Ç–∫–∏–π —à–∏—Ä–æ–∫–∏–π —É–∑–∫–∏–π —Ç–æ–ª—Å—Ç—ã–π —Ç–æ–Ω–∫–∏–π –≤—ã—Å–æ–∫–∏–π –Ω–∏–∑–∫–∏–π –≥–ª—É–±–æ–∫–∏–π –º–µ–ª–∫–∏–π –ø—Ä—è–º–æ–π –∫—Ä–∏–≤–æ–π –æ—Å—Ç—Ä—ã–π —Ç—É–ø–æ–π –≥–ª–∞–¥–∫–∏–π —à–µ—Ä—à–∞–≤—ã–π —á–∞—Å—Ç—ã–π —Ä–µ–¥–∫–∏–π –≥—É—Å—Ç–æ–π –∂–∏–¥–∫–∏–π –≤–∫—É—Å–Ω—ã–π –≥–æ—Ä—å–∫–∏–π –∫–∏—Å–ª—ã–π —Å–ª–∞–¥–∫–∏–π —Å–æ–ª–µ–Ω—ã–π –ø—Ä–µ—Å–Ω—ã–π —Å–≤–µ—Ç–ª—ã–π —Ç–µ–º–Ω—ã–π —è—Ä–∫–∏–π —Ç—É—Å–∫–ª—ã–π —Ü–≤–µ—Ç–Ω–æ–π –º—É—Ç–Ω—ã–π –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –Ω–µ–∂–Ω—ã–π –≥—Ä—É–±—ã–π –≤–µ—Ä–Ω—ã–π –ª–æ–∂–Ω—ã–π —á–µ—Å—Ç–Ω—ã–π –ø–æ–¥–ª—ã–π —Å–º–µ–ª—ã–π —Ç—Ä—É—Å–ª–∏–≤—ã–π –≥–æ—Ä–¥—ã–π —Å–∫—Ä–æ–º–Ω—ã–π –∂–∞–¥–Ω—ã–π —â–µ–¥—Ä—ã–π —Å—ã—Ç—ã–π –≥–æ–ª–æ–¥–Ω—ã–π –ø–æ–ª–Ω—ã–π –ø—É—Å—Ç–æ–π —Ü–µ–ª—ã–π –±–∏—Ç—ã–π –Ω—É–∂–Ω—ã–π –ª–∏—à–Ω–∏–π –≤–∞–∂–Ω—ã–π –≥–ª–∞–≤–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ª–æ–∂–Ω—ã–π —Ç—Ä—É–¥–Ω—ã–π –ª–µ–≥–∫–∏–π —Ä–∞–Ω–Ω–∏–π –ø–æ–∑–¥–Ω–∏–π —é–Ω—ã–π —Å—Ç–∞—Ä—ã–π –º–æ–ª–æ–¥–æ–π –∑—Ä–µ–ª—ã–π –¥–µ—Ç—Å–∫–∏–π –∂–µ–Ω—Å–∫–∏–π –º—É–∂—Å–∫–æ–π —Ä—É—Å—Å–∫–∏–π —á—É–∂–æ–π —Ä–æ–¥–Ω–æ–π –¥–∏–∫–∏–π —Ä—É—á–Ω–æ–π –¥–æ–º–∞—à–Ω–∏–π –ª–µ—Å–Ω–æ–π —Ä–µ—á–Ω–æ–π –º–æ—Ä—Å–∫–æ–π –≥–æ—Ä–Ω—ã–π —Å—Ç–µ–ø–Ω–æ–π –ø–æ–ª–µ–≤–æ–π –ª—É–≥–æ–≤–æ–π –∑–∏–º–Ω–∏–π –ª–µ—Ç–Ω–∏–π –≤–µ—Å–µ–Ω–Ω–∏–π –æ—Å–µ–Ω–Ω–∏–π —É—Ç—Ä–µ–Ω–Ω–∏–π –¥–Ω–µ–≤–Ω–æ–π –≤–µ—á–µ—Ä–Ω–∏–π –Ω–æ—á–Ω–æ–π –≤—á–µ—Ä–∞—à–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–π –ø—Ä–æ—à–ª—ã–π –±—É–¥—É—â–∏–π –≤–µ—á–Ω—ã–π –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∫–æ—Ä—ã–π –¥–æ–ª–≥–∏–π –∫—Ä–∞—Ç–∫–∏–π —á–∞—Å—Ç—ã–π —Ä–µ–¥–∫–∏–π –ø–µ—Ä–≤—ã–π –≤—Ç–æ—Ä–æ–π —Ç—Ä–µ—Ç–∏–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫—Ä–∞–π–Ω–∏–π —Å—Ä–µ–¥–Ω–∏–π –≤–µ—Ä—Ö–Ω–∏–π –Ω–∏–∂–Ω–∏–π –±–ª–∏–∂–Ω–∏–π –¥–∞–ª—å–Ω–∏–π –∑–∞–¥–Ω–∏–π –ø–µ—Ä–µ–¥–Ω–∏–π –ª–µ–≤—ã–π –ø—Ä–∞–≤—ã–π –ø—Ä—è–º–æ–π –æ–±—Ä–∞—Ç–Ω—ã–π –≤—Å—Ç—Ä–µ—á–Ω—ã–π –ø–æ–ø—É—Ç–Ω—ã–π —Ç–∞–π–Ω—ã–π —è–≤–Ω—ã–π –≤–∏–¥–Ω—ã–π —Å–∫—Ä—ã—Ç—ã–π –æ–±—â–∏–π —á–∞—Å—Ç–Ω—ã–π –ª–∏—á–Ω—ã–π —á—É–∂–æ–π —Å–≤–æ–π –µ–¥–∏–Ω—ã–π —Ä–∞–∑–Ω—ã–π –≤—Å—è–∫–∏–π –∫–∞–∂–¥—ã–π –ª—é–±–æ–π –∏–Ω–æ–π –¥—Ä—É–≥–æ–π –ø—Ä–æ—á–∏–π`;

        function parseVocab(text) {
            return text.split(/\s+/).map(w => w.trim().toLowerCase()).filter(w => w.length > 0);
        }

        const wordsNoun = parseVocab(vocabNouns);
        const wordsVerb = parseVocab(vocabVerbs);
        const wordsAdj = parseVocab(vocabAdj);
        const wordsMix = [...wordsNoun, ...wordsVerb, ...wordsAdj].sort(() => Math.random() - 0.5);

        function generateMathProblem(difficulty) {
            let a, b, op, res;
            const ops = ['+', '-', '*', '/'];
            const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

            while (true) {
                op = ops[Math.floor(Math.random() * ops.length)];
                
                if (difficulty === 'math_table') { 
                    if (op === '+') { a = rand(2, 20); b = rand(2, 20); if(a+b > 30) continue; }
                    else if (op === '-') { a = rand(5, 30); b = rand(2, a); }
                    else if (op === '*') { a = rand(2, 9); b = rand(2, 9); }
                    else if (op === '/') { b = rand(2, 9); res = rand(2, 9); a = b * res; }
                } 
                else if (difficulty === 'math100') { 
                    if (op === '+') { a = rand(10, 80); b = rand(10, 20); }
                    else if (op === '-') { a = rand(20, 100); b = rand(5, a); }
                    else if (op === '*') { a = rand(3, 15); b = rand(2, 6); }
                    else if (op === '/') { b = rand(2, 8); res = rand(5, 12); a = b * res; }
                }
                else if (difficulty === 'math500') { 
                    if (op === '+') { a = rand(50, 400); b = rand(50, 100); }
                    else if (op === '-') { a = rand(150, 500); b = rand(50, a - 50); }
                    else if (op === '*') { a = rand(12, 40); b = rand(3, 9); }
                    else if (op === '/') { b = rand(4, 15); res = rand(15, 30); a = b * res; }
                }

                if (op === '+') res = a + b;
                if (op === '-') res = a - b;
                if (op === '*') res = a * b;
                if (op === '/') res = a / b;

                if (difficulty === 'math_table' && res > 81) continue;
                if (difficulty === 'math100' && res > 100) continue;
                if (difficulty === 'math500' && (res < 100 || res > 500)) continue;

                let visualOp = op;
                if(op === '*') visualOp = '√ó';
                if(op === '/') visualOp = ':';

                return {
                    question: `${a} ${visualOp} ${b}`,
                    answer: res.toString()
                };
            }
        }

        // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
        let currentMode = 'noun'; 
        let activeWordList = wordsNoun;
        let isMathMode = false;

        let nLevel = 2;
        let targetInputs = 20;
        let memoTime = 3; 
        let history = []; 
        let recallIndex = 0;
        let attempts = 3;
        let isGameRunning = false;
        let isPaused = false;
        let needsInput = false;
        
        let gameTimer = null; 
        let cardTimerInterval = null;
        let totalSeconds = 0;
        let mainTimerInterval = null;

        // DOM
        const setupScreen = document.getElementById('setup-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const wordCard = document.getElementById('word-card');
        const wordDisplay = document.getElementById('word-display');
        const wordIndexEl = document.getElementById('word-index');
        const cardTimerEl = document.getElementById('card-timer');
        const inputArea = document.getElementById('input-area');
        const nativeInput = document.getElementById('native-input');
        const attemptsBar = document.getElementById('attempts-bar');
        const waitMsg = document.getElementById('wait-msg');
        const pauseOverlay = document.getElementById('pause-overlay');
        const timerDisplay = document.getElementById('timer');
        const progressDisplay = document.getElementById('progress');

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ï–ù–Æ ---
        function onInputFocus(inputElement) {
            document.getElementById('setup-screen').style.paddingBottom = "350px";
            setTimeout(() => inputElement.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
        }
        function onInputBlur() {
            document.getElementById('setup-screen').style.paddingBottom = "20px";
        }

        // --- –í–´–ë–û–† –†–ï–ñ–ò–ú–ê ---
        function setMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (mode.startsWith('math') || mode === 'super_mix') {
                // –ï—Å–ª–∏ —á–∏—Å—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏–ª–∏ –º–∏–∫—Å - —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –Ω–µ –Ω—É–∂–µ–Ω
                isMathMode = false; // –°–±—Ä–æ—Å–∏–º, —É—Ç–æ—á–Ω–∏–º –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            } else {
                if (mode === 'noun') activeWordList = wordsNoun;
                else if (mode === 'verb') activeWordList = wordsVerb;
                else if (mode === 'adj') activeWordList = wordsAdj;
                else if (mode === 'mix') activeWordList = wordsMix;
            }
        }

        // --- –ò–ì–†–ê ---
        function showSetup() {
            clearTimeout(gameTimer);
            clearInterval(mainTimerInterval);
            clearInterval(cardTimerInterval);
            setupScreen.classList.remove('hidden');
            gameScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
        }

        function startGame() {
            nLevel = parseInt(document.getElementById('n-level').value);
            targetInputs = parseInt(document.getElementById('round-count').value);
            memoTime = parseInt(document.getElementById('memo-time').value);

            if (targetInputs <= nLevel) {
                targetInputs = nLevel + 1;
                document.getElementById('round-count').value = targetInputs;
            }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤
            if (!currentMode.startsWith('math') && currentMode !== 'super_mix' && targetInputs > activeWordList.length) {
                targetInputs = activeWordList.length;
            }

            history = [];
            recallIndex = 0;
            isGameRunning = true;
            isPaused = false;
            
            // –°–±—Ä–æ—Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            nativeInput.setAttribute('type', 'text');
            nativeInput.setAttribute('inputmode', 'text');

            totalSeconds = 0;
            timerDisplay.innerText = "00:00";
            document.getElementById('display-n').innerText = nLevel;
            updateProgress();

            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            resultScreen.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            
            clearInterval(mainTimerInterval);
            mainTimerInterval = setInterval(() => {
                if(!isPaused && isGameRunning) {
                    totalSeconds++;
                    const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
                    const s = (totalSeconds % 60).toString().padStart(2, '0');
                    timerDisplay.innerText = `${m}:${s}`;
                }
            }, 1000);

            nextTurn();
        }

        function stopGame() {
            isGameRunning = false;
            showSetup();
        }

        function togglePause() {
            if (!isGameRunning) return;
            isPaused = !isPaused;
            if (isPaused) {
                clearTimeout(gameTimer);
                clearInterval(cardTimerInterval);
                pauseOverlay.classList.remove('hidden');
                nativeInput.blur();
            } else {
                pauseOverlay.classList.add('hidden');
                if (needsInput) {
                    nativeInput.focus();
                } else {
                    nextTurn(); 
                }
            }
        }

        function nextTurn() {
            if (!isGameRunning) return;

            if (recallIndex >= targetInputs) {
                endGame();
                return;
            }

            nativeInput.value = '';
            nativeInput.className = '';
            attempts = 3;
            updateHearts();
            clearInterval(cardTimerInterval);

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            let isGenerating = history.length < targetInputs;
            let displayContent = "";

            if (isGenerating) {
                let item = {};
                // –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                let genType = 'word';
                
                if (currentMode.startsWith('math')) {
                    genType = 'math';
                } else if (currentMode === 'super_mix') {
                    // 50/50 –°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∏–ª–∏ –¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è
                    genType = Math.random() < 0.5 ? 'math' : 'word';
                }

                if (genType === 'math') {
                    // –ï—Å–ª–∏ —Å—É–ø–µ—Ä-–º–∏–∫—Å, —Ç–æ –ª–µ–≥–∫–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –∏–Ω–∞—á–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
                    let difficulty = currentMode === 'super_mix' ? 'math_table' : currentMode;
                    item = generateMathProblem(difficulty);
                    item.type = 'math';
                } else {
                    // –°–ª–æ–≤–∞ (–¥–ª—è —Å—É–ø–µ—Ä-–º–∏–∫—Å–∞ –±–µ—Ä–µ–º —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ)
                    let list = (currentMode === 'super_mix') ? wordsNoun : activeWordList;
                    const w = list[Math.floor(Math.random() * list.length)];
                    item = { question: w, answer: w, type: 'word' };
                }

                history.push(item);
                displayContent = item.question;
                wordDisplay.classList.remove('countdown-big');
            } else {
                let remaining = targetInputs - recallIndex;
                displayContent = remaining;
                wordDisplay.classList.add('countdown-big');
            }

            wordDisplay.innerText = displayContent;
            needsInput = history.length > nLevel;

            if (needsInput) {
                // === –ê–ö–¢–ò–í–ù–´–ô –•–û–î (–í–í–û–î) ===
                wordCard.classList.remove('hidden');
                inputArea.classList.remove('hidden');
                waitMsg.classList.add('hidden');
                
                wordIndexEl.classList.add('hidden');
                cardTimerEl.classList.add('hidden');
                updateProgress();
                
                // *** –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ï –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ö–õ–ê–í–ò–ê–¢–£–†–´ ***
                const targetIndex = history.length - 1 - nLevel;
                const targetItem = history[targetIndex];
                
                if (targetItem.type === 'math') {
                    nativeInput.setAttribute('type', 'tel');
                    nativeInput.setAttribute('inputmode', 'decimal');
                } else {
                    nativeInput.setAttribute('type', 'text');
                    nativeInput.setAttribute('inputmode', 'text');
                }
                
                setTimeout(() => { if(!isPaused) nativeInput.focus(); }, 50);

            } else {
                // === –ó–ê–ü–û–ú–ò–ù–ê–ù–ò–ï (–ü–∞—Å—Å–∏–≤–Ω–∞—è —Ñ–∞–∑–∞) ===
                wordCard.classList.remove('hidden');
                inputArea.classList.add('hidden');
                waitMsg.classList.add('hidden'); 
                nativeInput.blur();
                
                progressDisplay.innerText = `${recallIndex}/${targetInputs}`;
                
                wordIndexEl.innerText = history.length;
                wordIndexEl.classList.remove('hidden');
                
                cardTimerEl.classList.remove('hidden');
                let timeLeft = memoTime;
                cardTimerEl.innerText = timeLeft;
                
                cardTimerInterval = setInterval(() => {
                    timeLeft--;
                    if(timeLeft < 1) timeLeft = 0;
                    cardTimerEl.innerText = timeLeft;
                }, 1000);
                
                gameTimer = setTimeout(() => {
                    if(!isGameRunning || isPaused) return;
                    clearInterval(cardTimerInterval);
                    nextTurn();
                }, memoTime * 1000); 
            }
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            if (!needsInput || isPaused) return;

            let userText = nativeInput.value.trim().toLowerCase();
            if (!userText) return;

            if (history[recallIndex].type === 'math') {
                userText = userText.replace(',', '.');
            }

            const targetItem = history[recallIndex];
            const targetAnswer = targetItem.answer.toLowerCase();

            let isCorrect = false;
            // –î–ª—è —Å–ª–æ–≤ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º —ë
            const normUser = userText.replace(/—ë/g, '–µ');
            const normTarget = targetAnswer.replace(/—ë/g, '–µ');
            
            // –î–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –¥–ª—è —Å–ª–æ–≤ - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ
            isCorrect = (normUser === normTarget);

            if (isCorrect) {
                nativeInput.classList.add('input-success');
                finishRound(true);
            } else {
                attempts--;
                updateHearts();
                nativeInput.classList.add('input-error');
                if (navigator.vibrate) navigator.vibrate(200);

                gameTimer = setTimeout(() => {
                    nativeInput.classList.remove('input-error');
                    nativeInput.value = '';
                }, 500);

                if (attempts <= 0) {
                    nativeInput.value = targetAnswer; 
                    gameTimer = setTimeout(() => {
                        finishRound(false);
                    }, 2000);
                }
            }
        }
        
        function finishRound(success) {
            recallIndex++; 
            updateProgress();
            let delay = success ? 400 : 100; 
            if(!success && attempts <=0) delay = 100; 
            
            if(success) {
                 gameTimer = setTimeout(() => { nextTurn(); }, delay);
            } else if (attempts <= 0) {
                 nextTurn();
            }
        }

        function updateHearts() {
            let h = "";
            for(let i=0; i < attempts; i++) h += "üñ§ "; 
            attemptsBar.innerText = h;
        }

        function updateProgress() {
            let displayCount = recallIndex;
            if (needsInput && recallIndex < targetInputs) displayCount = recallIndex + 1;
            progressDisplay.innerText = `${displayCount}/${targetInputs}`;
        }

        function endGame() {
            isGameRunning = false;
            clearInterval(mainTimerInterval);
            clearInterval(cardTimerInterval);
            nativeInput.blur();
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            document.getElementById('res-level').innerText = nLevel + "-Back";
            document.getElementById('final-score').innerText = recallIndex; 
            const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const s = (totalSeconds % 60).toString().padStart(2, '0');
            document.getElementById('final-time').innerText = `${m}:${s}`;
        }
    </script>
</body>
</html>